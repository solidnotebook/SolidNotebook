window.SN={Connection:function(e){function n(){throw new Error("invalid param")}function c(e,t,n,o,i){e.style.left=Math.round(t)+"px",e.style.top=Math.round(n)+"px",e.style.width=Math.round(o)+"px",e.style.height=Math.round(i)+"px"}function h(e,t){Number.isInteger(e)&&0<e||n()}var l=0,o=0,p={},u={},v=[],f="#000000",y="1.0",t=1,g="pencil",i=e.containerId,r=e.containerSize,s=e.strokeWidth,a=e.backgroundColor,m=e.horizontalPadding,w=e.verticalPadding,C=e.connectionId,d=e.diagrams,x=e.onOutboundMessage,M=e.diagramLoadingStateHTML,I=r.width,E=r.height,k=d.length;function b(e,t){var n={};n.type=e,n.tConnectionMono=Math.round(window.performance.now()),n.tConnectionUnix=Math.round(Date.now()),n.props=t,n.connectionId=C,n.iConnection=o,o++,x(n)}function L(n,o,e,t,i,r){var s=document.createElement("div");s.style.zIndex=4,s.style.position="absolute",c(s,e,t,i,r);var a=null;function d(e){a&&(P(a,e.offsetX,e.offsetY),A(a),b("update-item",{item:a}),B(a),a=null)}return s.addEventListener("mousedown",function(e){var t={pencil:"stroke",rectangle:"rectangle"}[g];t&&(a=O(t,"id_"+C+"_"+ ++l,n,o,f,y,i,r,e.offsetX,e.offsetY))}),s.addEventListener("mousemove",function(e){if(a){var t=e.offsetX,n=e.offsetY,o=a.points[a.points.length-1];2<=Math.sqrt(Math.pow(o.x-t,2),Math.pow(o.y-n,2))&&(P(a,e.offsetX,e.offsetY),b("update-item",{item:a}),B(a))}}),s.addEventListener("mouseleave",d),s.addEventListener("mouseup",d),s}h(I),h(E),h(m),h(w),h(k),this.handleInboundMessage=function(e){"received-event"!==e.type&&b("received-event",{connectionId:e.connectionId,iConnection:e.iConnection}),"update-item"===e.type?B(e.props.item):"scroll"===e.type&&(S.scrollTop=e.props.scrollTop,z=e.props.scrollTop)},this.setColor=function(e){(e=e.toUpperCase()).match(/^#[0-9A-F]{6}$/)||n(),f=e},this.setOpacity=function(e){y=e},this.setAllowScroll=function(e){S.style.overflowY=e?"scroll":"hidden"},this.setBroadcastScroll=function(e){t=e},this.setMode=function(e){e.match(/^(pencil|rectangle)$/)||n(),g=e},this.getItems=function(){var e=[];for(var t in p)p.hasOwnProperty(t)&&e.push(p[t]);return e},this.undo=function(){var e=v.length;if(0<e){var t=v[e-1];v=v.slice(0,e-1);var n=p[t];n.isUndone=!0,b("update-item",{item:n}),B(n)}};var T=document.getElementById(i),S=document.createElement("div");S.style.width=r.width+"px",S.style.height=r.height+"px",S.style.overflowY="scroll";var U=document.createElement("div"),Y=r.width-2*m,z=null,H=[],D=[],W=[],X=[],j=w;d.forEach(function(e,t){h(e.width),h(e.height);var n=Y,o=Math.round(e.height*(n/e.width));H.push(n),D.push(o),W.push(j);var i=j,r=m;j+=o+w;var s=new Image;s.onload=function(){U.removeChild(a),U.appendChild(s)},s.src=e.backgroundImage;var a=document.createElement("div");a.innerHTML=M;function d(e){e.style.userSelect="none",e.style.zIndex=2,e.style.position="absolute",c(e,r,i,n,o)}d(s),d(a),X.push(s);var l=L(e,t,r,i,n,o);U.appendChild(a),U.appendChild(l)}),U.style.width=r.width,U.style.height=j,U.style.backgroundColor=a,U.style.position="relative",S.style.backgroundColor=a,S.appendChild(U),T.appendChild(S);var B=function(e){var t=u[e.id];if(t?U.removeChild(t):v.push(e.id),delete u[e.id],!(p[e.id]=e).isUndone){var n=function(e){for(var t=1e12,n=-1e12,o=1e12,i=-1e12,r=0;r<e.length;r++){var s=e[r],a=s.x,d=s.y;a<t&&(t=a),d<o&&(o=d),n<a&&(n=a),i<d&&(i=d)}return{x:t,y:o,width:n-t,height:i-o}}(e.points),o=parseInt(e.canvasId,10),i=H[o]/e.viewWidth,r=m,s=W[o],a=document.createElement("div");if(a.style.position="absolute",a.style.zIndex=3,a.style.opacity=e.opacity,c(a,r+i*n.x-i*N,s+i*n.y-i*N,i*n.width+2*i*N,i*n.height+2*i*N),"rectangle"===e.type)a.style.backgroundColor=e.color;else if("stroke"===e.type){var d=$(e,n);a.innerHTML=d}U.appendChild(a),u[e.id]=a}};S.addEventListener("scroll",function(){var e=S.scrollTop;e!==z&&t&&b("scroll",{scrollTop:e})});var O=function(e,t,n,o,i,r,s,a,d,l){var c=Date.now(),h={id:t,type:e,canvasId:""+o,canvasWidth:n.width,canvasHeight:n.height,color:i,opacity:r,viewWidth:s,viewHeight:a,tConnectionUnix:c,isDone:!1,isUndone:!1,points:[]};return P(h,d,l),h},P=function(e,t,n){var o={x:t,y:n,t:Math.round(performance.now())};"rectangle"===e.type?e.points=e.points.slice(0,1).concat([o]):e.points.push(o)},A=function(e){e.isDone=!0},N=4,$=function(e,t){return['<svg viewBox="0 0 ',t.width+2*N," ",t.height+2*N,'" xmlns="http://www.w3.org/2000/svg/">','<polyline fill="none" stroke-linecap="round" stroke-linejoin="round"',' stroke="',e.color,'"',' stroke-width="',s,'"',' points="',e.points.map(function(e){return e.x-t.x+N+","+(e.y-t.y+N)}).join(" "),'" /></svg>'].join("")};return this}};