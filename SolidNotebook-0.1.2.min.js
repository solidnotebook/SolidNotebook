window.SN={Connection:function(e){function n(){throw new Error("invalid param")}function p(e,t,n,o,i){e.style.left=Math.round(t)+"px",e.style.top=Math.round(n)+"px",e.style.width=Math.round(o)+"px",e.style.height=Math.round(i)+"px"}function l(e,t){Number.isInteger(e)&&0<e||n()}var f,v=0,o=0,c={},h={},u=[],g="#000000",y="1.0",t=1,m="pencil",i=e.containerId,r=e.containerSize,s=e.strokeWidth,a=e.backgroundColor,w=e.horizontalPadding,C=e.verticalPadding,x=e.connectionId,d=e.diagrams,M=e.onOutboundMessage,E=e.diagramLoadingStateHTML,I=r.width,T=r.height,L=d.length;function b(e,t){var n={};n.type=e,n.tConnectionMono=Math.round(window.performance.now()),n.tConnectionUnix=Math.round(Date.now()),n.props=t,n.connectionId=x,n.iConnection=o,o++,M(n)}function k(n,o,e,t,i,r){var s=document.createElement("div");function a(e){var t=s.getBoundingClientRect();return{offsetX:e.clientX-t.left,offsetY:e.clientY-t.top}}s.style.zIndex=4,s.style.position="absolute",p(s,e,t,i,r);var d=null;function c(e){for(var t=0;t<e.changedTouches.length;t++)e.changedTouches[t].identifier===f&&u(a(e.changedTouches[t]))}s.addEventListener("touchstart",function(e){var t=e.changedTouches[0];m&&t&&(e.preventDefault(),f=t.identifier,l(a(t)))},!1),s.addEventListener("touchend",c,!1),s.addEventListener("touchcancel",c,!1),s.addEventListener("touchmove",function(e){for(var t=0;t<e.changedTouches.length;t++)e.changedTouches[t].identifier===f&&h(a(e.changedTouches[t]))},!1);var l=function(e){var t={pencil:"stroke",rectangle:"rectangle"}[m];t&&(d=P(t,"id_"+x+"_"+ ++v,n,o,g,y,i,r,e.offsetX,e.offsetY))},h=function(e){if(d){var t=e.offsetX,n=e.offsetY,o=d.points[d.points.length-1];2<=Math.sqrt(Math.pow(o.x-t,2)+Math.pow(o.y-n,2))&&(A(d,e.offsetX,e.offsetY),b("update-item",{item:d}),O(d))}};function u(e){d&&(A(d,e.offsetX,e.offsetY),N(d),b("update-item",{item:d}),O(d),d=null)}return s.addEventListener("mousedown",l),s.addEventListener("mousemove",h),s.addEventListener("mouseleave",u),s.addEventListener("mouseup",u),s}l(I),l(T),l(w),l(C),l(L),this.handleInboundMessage=function(e){"received-event"!==e.type&&b("received-event",{connectionId:e.connectionId,iConnection:e.iConnection}),"update-item"===e.type?O(e.props.item):"scroll"===e.type&&(S.scrollTop=e.props.scrollTop,z=e.props.scrollTop)},this.setColor=function(e){(e=e.toUpperCase()).match(/^#[0-9A-F]{6}$/)||n(),g=e},this.setOpacity=function(e){y=e},this.setAllowScroll=function(e){S.style.overflowY=e?"scroll":"hidden"},this.setBroadcastScroll=function(e){t=e},this.setMode=function(e){e&&!e.match(/^(pencil|rectangle)$/)&&n(),m=e},this.getItems=function(){var e=[];for(var t in c)c.hasOwnProperty(t)&&e.push(c[t]);return e},this.undo=function(){var e=u.length;if(0<e){var t=u[e-1];u=u.slice(0,e-1);var n=c[t];n.isUndone=!0,b("update-item",{item:n}),O(n)}};var Y=document.getElementById(i),S=document.createElement("div");S.style.width=r.width+"px",S.style.height=r.height+"px",S.style.overflowY="scroll";var U=document.createElement("div"),X=r.width-2*w,z=null,D=[],H=[],B=[],W=[],j=C;d.forEach(function(e,t){l(e.width),l(e.height);var n=X,o=Math.round(e.height*(n/e.width));D.push(n),H.push(o),B.push(j);var i=j,r=w;j+=o+C;var s=new Image;s.onload=function(){U.removeChild(a),U.appendChild(s)},s.src=e.backgroundImage;var a=document.createElement("div");a.innerHTML=E;function d(e){e.style.userSelect="none",e.style.zIndex=2,e.style.position="absolute",p(e,r,i,n,o)}d(s),d(a),W.push(s);var c=k(e,t,r,i,n,o);U.appendChild(a),U.appendChild(c)}),U.style.width=r.width,U.style.height=j,U.style.backgroundColor=a,U.style.position="relative",S.style.backgroundColor=a,S.appendChild(U),Y.appendChild(S);var O=function(e){var t=h[e.id];if(t?U.removeChild(t):u.push(e.id),delete h[e.id],!(c[e.id]=e).isUndone){var n=function(e){for(var t=1e12,n=-1e12,o=1e12,i=-1e12,r=0;r<e.length;r++){var s=e[r],a=s.x,d=s.y;a<t&&(t=a),d<o&&(o=d),n<a&&(n=a),i<d&&(i=d)}return{x:t,y:o,width:n-t,height:i-o}}(e.points),o=parseInt(e.canvasId,10),i=D[o]/e.viewWidth,r=w,s=B[o],a=document.createElement("div");if(a.style.position="absolute",a.style.zIndex=3,a.style.opacity=e.opacity,p(a,r+i*n.x-i*$,s+i*n.y-i*$,i*n.width+2*i*$,i*n.height+2*i*$),"rectangle"===e.type)a.style.backgroundColor=e.color;else if("stroke"===e.type){var d=_(e,n);a.innerHTML=d}U.appendChild(a),h[e.id]=a}};S.addEventListener("scroll",function(){var e=S.scrollTop;e!==z&&t&&b("scroll",{scrollTop:e})});var P=function(e,t,n,o,i,r,s,a,d,c){var l=Date.now(),h={id:t,type:e,canvasId:""+o,canvasWidth:n.width,canvasHeight:n.height,color:i,opacity:r,viewWidth:s,viewHeight:a,tConnectionUnix:l,isDone:!1,isUndone:!1,points:[]};return A(h,d,c),h},A=function(e,t,n){var o={x:t,y:n,t:Math.round(performance.now())};"rectangle"===e.type?e.points=e.points.slice(0,1).concat([o]):e.points.push(o)},N=function(e){e.isDone=!0},$=4,_=function(e,t){return['<svg style="position: absolute; top: 0; left: 0" viewBox="0 0 ',t.width+2*$," ",t.height+2*$,'" xmlns="http://www.w3.org/2000/svg/">','<polyline fill="none" stroke-linecap="round" stroke-linejoin="round"',' stroke="',e.color,'"',' stroke-width="',s,'"',' points="',e.points.map(function(e){return e.x-t.x+$+","+(e.y-t.y+$)}).join(" "),'" /></svg>'].join("")};return this}};